const e=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],t=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function n(e){return`\n    <style>\n      :host {\n        display: inline-flex;\n        line-height: 0;\n        flex-direction: column;\n        justify-content: end;\n      }\n\n      audio {\n        width: 100%;\n      }\n    </style>\n    <slot name="media">\n      <audio${r(e)}></audio>\n    </slot>\n    <slot></slot>\n  `}function i(e){return`\n    <style>\n      :host {\n        display: inline-block;\n        line-height: 0;\n      }\n\n      video {\n        max-width: 100%;\n        max-height: 100%;\n        min-width: 100%;\n        min-height: 100%;\n        object-fit: var(--media-object-fit, contain);\n        object-position: var(--media-object-position, 50% 50%);\n      }\n\n      video::-webkit-media-text-track-container {\n        transform: var(--media-webkit-text-track-transform);\n        transition: var(--media-webkit-text-track-transition);\n      }\n    </style>\n    <slot name="media">\n      <video${r(e)}></video>\n    </slot>\n    <slot></slot>\n  `}function a(a,{tag:r,is:s}){const o=globalThis.document?.createElement?.(r,{is:s}),d=o?function(e){const t=[];for(let n=Object.getPrototypeOf(e);n&&n!==HTMLElement.prototype;n=Object.getPrototypeOf(n)){const e=Object.getOwnPropertyNames(n);t.push(...e)}return t}(o):[];return class c extends a{static getTemplateHTML=r.endsWith("audio")?n:i;static shadowRootOptions={mode:"open"};static Events=e;static#e=!1;static get observedAttributes(){c.#t();return[...o?.constructor?.observedAttributes??[],...t]}static#t(){if(this.#e)return;this.#e=!0;const e=new Set(this.observedAttributes);e.delete("muted");for(const t of d)if(!(t in this.prototype))if("function"==typeof o[t])this.prototype[t]=function(...e){this.#n();return(()=>{if(this.call)return this.call(t,...e);const n=this.nativeEl?.[t];return n?.apply(this.nativeEl,e)})()};else{const n={get(){this.#n();const n=t.toLowerCase();if(e.has(n)){const e=this.getAttribute(n);return null!==e&&(""===e||e)}return this.get?.(t)??this.nativeEl?.[t]}};t!==t.toUpperCase()&&(n.set=function(n){this.#n();const i=t.toLowerCase();e.has(i)?!0===n||!1===n||null==n?this.toggleAttribute(i,Boolean(n)):this.setAttribute(i,n):this.set?this.set(t,n):this.nativeEl&&(this.nativeEl[t]=n)}),Object.defineProperty(this.prototype,t,n)}}#i=!1;#a=null;#r=new Map;#s;get;set;call;get nativeEl(){return this.#n(),this.#a??this.querySelector(":scope > [slot=media]")??this.querySelector(r)??this.shadowRoot?.querySelector(r)??null}set nativeEl(e){this.#a=e}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(e){this.toggleAttribute("muted",e)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",`${e}`)}get preload(){return this.getAttribute("preload")??this.nativeEl?.preload}set preload(e){this.setAttribute("preload",`${e}`)}#n(){this.#i||(this.#i=!0,this.init())}init(){if(!this.shadowRoot){this.attachShadow({mode:"open"});const e=function(e){const t={};for(const n of e)t[n.name]=n.value;return t}(this.attributes);s&&(e.is=s),r&&(e.part=r),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(e)}this.nativeEl.muted=this.hasAttribute("muted");for(const e of d)this.#o(e);this.#s=new MutationObserver(this.#d.bind(this)),this.shadowRoot.addEventListener("slotchange",()=>this.#c()),this.#c();for(const e of this.constructor.Events)this.shadowRoot.addEventListener(e,this,!0)}handleEvent(e){e.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(e.type,{detail:e.detail}))}#c(){const e=new Map(this.#r),t=this.shadowRoot?.querySelector("slot:not([name])"),n=t?.assignedElements({flatten:!0}).filter(e=>["track","source"].includes(e.localName));n.forEach(t=>{e.delete(t);let n=this.#r.get(t);n||(n=t.cloneNode(),this.#r.set(t,n),this.#s?.observe(t,{attributes:!0})),this.nativeEl?.append(n),this.#l(n)}),e.forEach((e,t)=>{e.remove(),this.#r.delete(t)})}#d(e){for(const t of e)if("attributes"===t.type){const{target:e,attributeName:n}=t,i=this.#r.get(e);i&&n&&(i.setAttribute(n,e.getAttribute(n)??""),this.#l(i))}}#l(e){e&&"track"===e.localName&&e.default&&("chapters"===e.kind||"metadata"===e.kind)&&"disabled"===e.track.mode&&(e.track.mode="hidden")}#o(e){if(Object.prototype.hasOwnProperty.call(this,e)){const t=this[e];delete this[e],this[e]=t}}attributeChangedCallback(e,t,n){this.#n(),this.#h(e,t,n)}#h(e,t,n){["id","class"].includes(e)||!c.observedAttributes.includes(e)&&this.constructor.observedAttributes.includes(e)||(null===n?this.nativeEl?.removeAttribute(e):this.nativeEl?.getAttribute(e)!==n&&this.nativeEl?.setAttribute(e,n))}connectedCallback(){this.#n()}}}function r(e){let n="";for(const i in e){if(!t.includes(i))continue;const a=e[i];n+=""===a?` ${i}`:` ${i}="${a}"`}return n}const s=a(globalThis.HTMLElement??class{},{tag:"video"});a(globalThis.HTMLElement??class{},{tag:"audio"});class o extends Event{track;constructor(e,t){super(e),this.track=t.track}}const d=new WeakMap;function c(e){return d.get(e)??function(e,t){let n=d.get(e);n||d.set(e,n={});return Object.assign(n,t)}(e,{})}function l(e,t){const n=e.videoTracks;c(t).media=e,c(t).renditionSet||(c(t).renditionSet=new Set);const i=c(n).trackSet;i.add(t);const a=i.size-1;a in u.prototype||Object.defineProperty(u.prototype,a,{get(){return[...c(this).trackSet][a]}}),queueMicrotask(()=>{n.dispatchEvent(new o("addtrack",{track:t}))})}function h(e){const t=c(e).media?.videoTracks;if(!t)return;c(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new o("removetrack",{track:e}))})}class u extends EventTarget{#u;#k;#v;constructor(){super(),c(this).trackSet=new Set}get#g(){return c(this).trackSet}[Symbol.iterator](){return this.#g.values()}get length(){return this.#g.size}getTrackById(e){return[...this.#g].find(t=>t.id===e)??null}get selectedIndex(){return[...this.#g].findIndex(e=>e.selected)}get onaddtrack(){return this.#u}set onaddtrack(e){this.#u&&(this.removeEventListener("addtrack",this.#u),this.#u=void 0),"function"==typeof e&&(this.#u=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#k}set onremovetrack(e){this.#k&&(this.removeEventListener("removetrack",this.#k),this.#k=void 0),"function"==typeof e&&(this.#k=e,this.addEventListener("removetrack",e))}get onchange(){return this.#v}set onchange(e){this.#v&&(this.removeEventListener("change",this.#v),this.#v=void 0),"function"==typeof e&&(this.#v=e,this.addEventListener("change",e))}}class k extends Event{rendition;constructor(e,t){super(e),this.rendition=t.rendition}}function v(e){return[...c(e).media.videoTracks].filter(e=>e.selected).flatMap(e=>[...c(e).renditionSet])}class g extends EventTarget{#b;#p;#v;[Symbol.iterator](){return v(this).values()}get length(){return v(this).length}getRenditionById(e){return v(this).find(t=>`${t.id}`==`${e}`)??null}get selectedIndex(){return v(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[t,n]of v(this).entries())n.selected=t===e}get onaddrendition(){return this.#b}set onaddrendition(e){this.#b&&(this.removeEventListener("addrendition",this.#b),this.#b=void 0),"function"==typeof e&&(this.#b=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#p}set onremoverendition(e){this.#p&&(this.removeEventListener("removerendition",this.#p),this.#p=void 0),"function"==typeof e&&(this.#p=e,this.addEventListener("removerendition",e))}get onchange(){return this.#v}set onchange(e){this.#v&&(this.removeEventListener("change",this.#v),this.#v=void 0),"function"==typeof e&&(this.#v=e,this.addEventListener("change",e))}}class b{src;id;width;height;bitrate;frameRate;codec;#f=!1;get selected(){return this.#f}set selected(e){this.#f!==e&&(this.#f=e,function(e){const t=c(e).media.videoRenditions;t&&!c(t).changeRequested&&(c(t).changeRequested=!0,queueMicrotask(()=>{delete c(t).changeRequested,c(e).track.selected&&t.dispatchEvent(new Event("change"))}))}(this))}}class p{id;kind;label="";language="";sourceBuffer;#f=!1;addRendition(e,t,n,i,a,r){const s=new b;return s.src=e,s.width=t,s.height=n,s.frameRate=r,s.bitrate=a,s.codec=i,function(e,t){const n=c(e).media.videoRenditions;c(t).media=c(e).media,c(t).track=e;const i=c(e).renditionSet;i.add(t);const a=i.size-1;a in g.prototype||Object.defineProperty(g.prototype,a,{get(){return v(this)[a]}}),queueMicrotask(()=>{e.selected&&n.dispatchEvent(new k("addrendition",{rendition:t}))})}(this,s),s}removeRendition(e){!function(e){const t=c(e).media.videoRenditions,n=c(e).track;c(n).renditionSet.delete(e),queueMicrotask(()=>{c(e).track.selected&&t.dispatchEvent(new k("removerendition",{rendition:e}))})}(e)}get selected(){return this.#f}set selected(e){this.#f!==e&&(this.#f=e,!0===e&&function(e){const t=c(e).media.videoTracks??[];let n=!1;for(const i of t)i!==e&&(i.selected=!1,n=!0);if(n){if(c(t).changeRequested)return;c(t).changeRequested=!0,queueMicrotask(()=>{delete c(t).changeRequested,t.dispatchEvent(new Event("change"))})}}(this))}}function f(e){return[...c(e).media.audioTracks].filter(e=>e.enabled).flatMap(e=>[...c(e).renditionSet])}class m extends EventTarget{#b;#p;#v;[Symbol.iterator](){return f(this).values()}get length(){return f(this).length}getRenditionById(e){return f(this).find(t=>`${t.id}`==`${e}`)??null}get selectedIndex(){return f(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[t,n]of f(this).entries())n.selected=t===e}get onaddrendition(){return this.#b}set onaddrendition(e){this.#b&&(this.removeEventListener("addrendition",this.#b),this.#b=void 0),"function"==typeof e&&(this.#b=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#p}set onremoverendition(e){this.#p&&(this.removeEventListener("removerendition",this.#p),this.#p=void 0),"function"==typeof e&&(this.#p=e,this.addEventListener("removerendition",e))}get onchange(){return this.#v}set onchange(e){this.#v&&(this.removeEventListener("change",this.#v),this.#v=void 0),"function"==typeof e&&(this.#v=e,this.addEventListener("change",e))}}class y{src;id;bitrate;codec;#f=!1;get selected(){return this.#f}set selected(e){this.#f!==e&&(this.#f=e,function(e){const t=c(e).media.audioRenditions;t&&!c(t).changeRequested&&(c(t).changeRequested=!0,queueMicrotask(()=>{delete c(t).changeRequested,c(e).track.enabled&&t.dispatchEvent(new Event("change"))}))}(this))}}function E(e,t){const n=e.audioTracks;c(t).media=e,c(t).renditionSet||(c(t).renditionSet=new Set);const i=c(n).trackSet;i.add(t);const a=i.size-1;a in T.prototype||Object.defineProperty(T.prototype,a,{get(){return[...c(this).trackSet][a]}}),queueMicrotask(()=>{n.dispatchEvent(new o("addtrack",{track:t}))})}function C(e){const t=c(e).media?.audioTracks;if(!t)return;c(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new o("removetrack",{track:e}))})}class T extends EventTarget{#u;#k;#v;constructor(){super(),c(this).trackSet=new Set}get#g(){return c(this).trackSet}[Symbol.iterator](){return this.#g.values()}get length(){return this.#g.size}getTrackById(e){return[...this.#g].find(t=>t.id===e)??null}get onaddtrack(){return this.#u}set onaddtrack(e){this.#u&&(this.removeEventListener("addtrack",this.#u),this.#u=void 0),"function"==typeof e&&(this.#u=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#k}set onremovetrack(e){this.#k&&(this.removeEventListener("removetrack",this.#k),this.#k=void 0),"function"==typeof e&&(this.#k=e,this.addEventListener("removetrack",e))}get onchange(){return this.#v}set onchange(e){this.#v&&(this.removeEventListener("change",this.#v),this.#v=void 0),"function"==typeof e&&(this.#v=e,this.addEventListener("change",e))}}class R{id;kind;label="";language="";sourceBuffer;#m=!1;addRendition(e,t,n){const i=new y;return i.src=e,i.codec=t,i.bitrate=n,function(e,t){const n=c(e).media.audioRenditions;c(t).media=c(e).media,c(t).track=e;const i=c(e).renditionSet;i.add(t);const a=i.size-1;a in m.prototype||Object.defineProperty(m.prototype,a,{get(){return f(this)[a]}}),queueMicrotask(()=>{e.enabled&&n.dispatchEvent(new k("addrendition",{rendition:t}))})}(this,i),i}removeRendition(e){!function(e){const t=c(e).media.audioRenditions,n=c(e).track;c(n).renditionSet.delete(e),queueMicrotask(()=>{c(e).track.enabled&&t.dispatchEvent(new k("removerendition",{rendition:e}))})}(e)}get enabled(){return this.#m}set enabled(e){this.#m!==e&&(this.#m=e,function(e){const t=c(e).media.audioTracks;t&&!c(t).changeRequested&&(c(t).changeRequested=!0,queueMicrotask(()=>{delete c(t).changeRequested,t.dispatchEvent(new Event("change"))}))}(this))}}const w=S(globalThis.HTMLMediaElement,"video"),L=S(globalThis.HTMLMediaElement,"audio");function M(e){if(!e?.prototype)return e;const t=S(e,"video");t&&!`${t}`.includes("[native code]")||Object.defineProperty(e.prototype,"videoTracks",{get(){return function(e){let t=c(e).videoTracks;if(!t&&(t=new u,c(e).videoTracks=t,w)){const n=w.call(e.nativeEl??e);for(const t of n)l(e,t);n.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),n.addEventListener("addtrack",i=>{if([...t].some(e=>e instanceof p))for(const e of n)h(e);else l(e,i.track)}),n.addEventListener("removetrack",e=>{h(e.track)})}return t}(this)}});const n=S(e,"audio");n&&!`${n}`.includes("[native code]")||Object.defineProperty(e.prototype,"audioTracks",{get(){return function(e){let t=c(e).audioTracks;if(!t&&(t=new T,c(e).audioTracks=t,L)){const n=L.call(e.nativeEl??e);for(const t of n)E(e,t);n.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),n.addEventListener("addtrack",i=>{if([...t].some(e=>e instanceof R))for(const e of n)C(e);else E(e,i.track)}),n.addEventListener("removetrack",e=>{C(e.track)})}return t}(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(e,t="",n=""){const i=new p;return i.kind=e,i.label=t,i.language=n,l(this,i),i}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=h),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(e,t="",n=""){const i=new R;return i.kind=e,i.label=t,i.language=n,E(this,i),i}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=C),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return i(this)}});const i=e=>{let t=c(e).videoRenditions;return t||(t=new g,c(t).media=e,c(e).videoRenditions=t),t};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return a(this)}});const a=e=>{let t=c(e).audioRenditions;return t||(t=new m,c(t).media=e,c(e).audioRenditions=t),t};return e}function S(e,t){if(e?.prototype)return Object.getOwnPropertyDescriptor(e.prototype,`${t}Tracks`)?.get}export{s as C,M};
