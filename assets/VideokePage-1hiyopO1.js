import{R as e,j as t,r}from"./vendor-react-BqCNLigP.js";import{aa as n,ab as i,ac as o,r as s,ad as a,ae as l,af as c,ag as d,ah as u,ai as h,aj as p}from"./vendor-react-ui-Bu4CYNdA.js";import{g as m}from"./index-KckJq3FG.js";import"./vendor-players-DUwgxdJ7.js";import"./vendor-state-9eBMMYdn.js";import"./vendor-firebase-D_MHdhg9.js";import"./vendor-router-C4M7CORf.js";class y extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorId:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}static getDerivedStateFromProps(e,t){return e.videoId&&e.videoId!==t.errorId&&t.hasError?{hasError:!1,error:null,errorId:null}:null}componentDidCatch(e,t){this.setState({errorId:this.props.videoId})}render(){return this.state.hasError?t.jsxs("div",{className:"videoke-stage-fallback",children:[t.jsx("p",{children:"Video player encountered an error. Please try selecting another song."}),t.jsx("button",{type:"button",onClick:()=>this.setState({hasError:!1,error:null,errorId:null}),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Try Again"})]}):this.props.children}}const f=[{label:"OPM Classics",value:"opm karaoke minus one"},{label:"Duet Night",value:"karaoke duet songs"},{label:"Power Ballads",value:"power ballad karaoke"},{label:"Throwback 90s",value:"90s karaoke hits"},{label:"Party Hits",value:"party karaoke upbeat"},{label:"Tagalog Love",value:"tagalog love song karaoke"}];let v=null;const g=({videoId:e,onReady:n,onEnded:i,onError:o,registerPlayer:s})=>{const[a,l]=r.useState(0),c=r.useRef(null),d=r.useRef(null),u=r.useRef(!1),h=r.useRef(null),p=r.useRef(!0),[m,y]=r.useState(!0),f=r.useRef(null);r.useEffect(()=>{e&&h.current&&h.current!==e&&(l(e=>e+1),f.current&&(clearTimeout(f.current),f.current=null)),h.current=e},[e]),r.useEffect(()=>{if(e&&m)return f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{i?.()},24e4),()=>{f.current&&(clearTimeout(f.current),f.current=null)}},[e,m,i]);const g=r.useCallback(()=>{if(d.current)try{"function"==typeof d.current.stopVideo&&d.current.stopVideo(),"function"==typeof d.current.clearVideo&&d.current.clearVideo(),"function"==typeof d.current.destroy&&d.current.destroy()}catch(e){}if(d.current=null,u.current=!1,h.current=null,c.current)try{c.current.innerHTML=""}catch(t){}p.current&&s?.(null)},[s]);if(r.useEffect(()=>(p.current=!0,()=>{p.current=!1,g()}),[g]),r.useEffect(()=>{let t=!0;if(e)return("undefined"==typeof window?Promise.reject(new Error("YouTube API requires a browser environment.")):window.YT?.Player?Promise.resolve(window.YT):(v||(v=new Promise((e,t)=>{const r=()=>{v=null;const e=document.getElementById("youtube-iframe-api");if(e)try{e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)}catch(r){}t(new Error("Failed to load the YouTube player API."))};let n=document.getElementById("youtube-iframe-api");n?n.addEventListener("error",r,{once:!0}):(n=document.createElement("script"),n.id="youtube-iframe-api",n.src="https://www.youtube.com/iframe_api",n.async=!0,n.onerror=r,document.head.appendChild(n));const i=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{i?.();const t=document.getElementById("youtube-iframe-api");t&&(t.onerror=null),window.YT?.Player?e(window.YT):r()}})),v)).then(r=>{if(!t)return;if(!c.current)return;const a={autoplay:1,rel:0,modestbranding:1,playsinline:1,enablejsapi:1,controls:1,iv_load_policy:3,fs:1,mute:0,origin:"undefined"!=typeof window?window.location.origin:void 0};d.current?(()=>{if(u.current&&d.current&&p.current)try{if(h.current!==e)return g(),void setTimeout(()=>{p.current&&c.current&&(c.current.innerHTML="",d.current=new r.Player(c.current,{videoId:e,width:"100%",height:"100%",playerVars:a,events:{onReady:r=>{t&&p.current&&(u.current=!0,h.current=e,s?.(r.target),n?.(r))},onStateChange:e=>{t&&p.current&&(e.data===r.PlayerState.ENDED&&i?.(),e.data===r.PlayerState.PLAYING&&setTimeout(()=>{if(d.current&&p.current)try{const e=c.current?.querySelector("iframe");e&&(e.style.visibility="visible",e.style.opacity="1")}catch(e){}},100))},onError:e=>{t&&p.current&&o?.(e)}}}))},500);s?.(d.current),n?.({target:d.current})}catch(l){p.current&&o?.(l)}})():(d.current=new r.Player(c.current,{videoId:e,width:"100%",height:"100%",playerVars:a,events:{onReady:r=>{t&&p.current&&(u.current=!0,h.current=e,s?.(r.target),n?.(r))},onStateChange:e=>{t&&p.current&&(e.data===r.PlayerState.ENDED&&i?.(),e.data===r.PlayerState.PLAYING&&setTimeout(()=>{if(d.current&&p.current)try{const e=c.current?.querySelector("iframe");e&&(e.style.visibility="visible",e.style.opacity="1")}catch(e){}},100))},onError:e=>{t&&p.current&&o?.(e)}}}),s?.(d.current))}).catch(e=>{t&&(y(!0),setTimeout(()=>{n?.({target:null})},500))}),()=>{t=!1};g()},[e,n,i,o,s,g]),r.useEffect(()=>{if(!m)return;const e=setTimeout(()=>{n?.({target:null})},300);return()=>clearTimeout(e)},[n,e,m]),r.useEffect(()=>{if(!m)return;const e=e=>{if("https://www.youtube.com"===e.origin)try{JSON.parse(e.data).event}catch{}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[i,m]),m){const r=`https://www.youtube.com/embed/${e}?autoplay=1&rel=0&modestbranding=1&controls=1&enablejsapi=1`;return t.jsx("div",{style:{width:"100%",height:"100%"},children:t.jsx("iframe",{src:r,title:"YouTube Video Player",width:"100%",height:"100%",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{border:0},onLoad:()=>{setTimeout(()=>{n?.({target:null})},200)}})},a)}return t.jsx("div",{ref:c,className:"videoke-stage-player"})},b=()=>{const{showToast:e}=m(),[v,b]=r.useState("OPM karaoke"),[k,x]=r.useState([]),[w,j]=r.useState(!1),[N,C]=r.useState(null),[T,E]=r.useState(null),[S,P]=r.useState(!0),[I,L]=r.useState([]),[A,R]=r.useState(null),[q,Y]=r.useState(!1),[M,$]=r.useState(!1),U=r.useRef(null),V=r.useRef(0),Q=r.useCallback(e=>{U.current=e??null},[]),D=r.useCallback(()=>{const t=U.current;if(t)try{if("function"==typeof t.playVideo)return void setTimeout(()=>{try{t.playVideo(),Y(!0),$(!1)}catch(r){q||(setTimeout(()=>$(!0),2e3),e("Click the play button to start","info",3e3))}},500);if("function"==typeof t.play){const r=t.play();r?.catch?r.catch(t=>{q||e("Click the video to start playing","info",3e3)}):Y(!0)}}catch(r){q||e("Click the video to start playing","info",3e3)}},[e,q]),F=async t=>{const r=(t??v)?.trim();if(!r)return C("Please enter a song or artist."),x([]),void j(!1);t&&t!==v&&b(r);const n=V.current+1;V.current=n,j(!0),C(null),x([]);try{e("Searching for karaoke videos...","info",1500);const t=await(async e=>{if(!e)return[];try{try{const t=await fetch(`/api/youtube?q=${encodeURIComponent(e)}`);if(t.ok){const e=await t.json();if(e.success&&e.results.length>0)return e.results}}catch{}const r=["https://yewtu.be","https://inv.vern.cc","https://invidious.tiekoetter.com","https://vid.puffyan.us","https://invidious.sethforprivacy.com","https://inv.riverside.rocks","https://invidious.flokinet.to"];let n=[];for(const i of r)try{const t=`${i}/api/v1/search?q=${encodeURIComponent(e)}&type=video&sort_by=relevance`,r=new AbortController,o=setTimeout(()=>r.abort(),8e3),s=await fetch(t,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},signal:r.signal});if(clearTimeout(o),s.ok){const e=await s.json();if(Array.isArray(e)&&e.length>0&&(n=e.filter(e=>e.videoId&&e.title).map(e=>({id:e.videoId,title:e.title,videoId:e.videoId,author:e.author||"Unknown Artist",lengthSeconds:e.lengthSeconds,viewCount:e.viewCount,channel:{name:e.author||"Unknown Artist"},snippet:{channelTitle:e.author||"Unknown Artist",title:e.title}})).slice(0,20),n.length>0))break}}catch(t){t.name;continue}return 0===n.length&&(n=[{id:"dQw4w9WgXcQ",title:"OPM Karaoke Mix - Classic Filipino Love Songs",videoId:"dQw4w9WgXcQ",author:"Karaoke Channel",channel:{name:"Karaoke Channel"},snippet:{channelTitle:"Karaoke Channel",title:"OPM Karaoke Mix - Classic Filipino Love Songs"}}]),n}catch(N){return[]}})(r);if(n!==V.current)return;if(!t||0===t.length)return C("No results found. Try a different search term or check your internet connection."),void L([]);const i=t.map(e=>{const t=e?.id,r="string"==typeof t&&t||t?.videoId||e?.videoId||e?.video?.id||e?.id?.id;if(!r)return null;return{id:r,title:e.title||e.snippet?.title||"YouTube Video",source:"YouTube",embedUrl:`https://www.youtube.com/embed/${r}?rel=0&modestbranding=1&autoplay=0`,playerUrl:`https://www.youtube.com/watch?v=${r}`,watchUrl:`https://www.youtube.com/watch?v=${r}`,description:e.author||e.channel?.name||e.snippet?.channelTitle||"YouTube Video"}}).filter(Boolean);x(i),L([]),i.length>0&&e(`Found ${i.length} karaoke tracks!`,"success",2e3)}catch(i){if(n!==V.current)return;const t=i instanceof Error&&i.message?i.message:"An unexpected error occurred while searching.";C(`Failed to fetch results. ${t}`),x([]),L([]),e("Search failed. Please try again.","error",3e3)}finally{n===V.current&&j(!1)}};r.useEffect(()=>{F(v)},[]),r.useEffect(()=>{if(0!==k.length)return T&&k.some(e=>e.id===T.id)?void 0:(E(k[0]),void L(k.slice(1)));E(null)},[k,T]),r.useEffect(()=>{!T&&k.length>0&&(E(k[0]),L(k.slice(1)))},[T,k]),r.useEffect(()=>{R(null)},[T?.id]),r.useEffect(()=>{const e=()=>{q||Y(!0)};return document.addEventListener("click",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e)}},[q]);const K=r.useCallback((e,t={})=>{const{fromQueue:r=!1}=t,n=T;Y(!0),R(null),$(!1),E(e),L(t=>{const i=t.filter(t=>t.id!==e.id);return r?i:n&&n.id!==e.id?i.some(e=>e.id===n.id)?i:[n,...i]:i}),"undefined"!=typeof window&&window.scrollTo({top:0,behavior:"smooth"})},[T]),O=()=>{T&&window.open(T.watchUrl,"_blank","noopener,noreferrer")},W=r.useCallback(t=>{let r="Playback error. Trying next song...";150===t?.data||101===t?.data?r="This track is blocked from being played. Skipping to next song...":5===t?.data?r="HTML5 player error. Trying next song...":2===t?.data?r="Invalid video ID. Skipping to next song...":t instanceof Error&&t.message&&(r=`Error: ${t.message}. Trying next song...`),R(r),e(r,"error",2e3),setTimeout(()=>{if(I.length>0){const t=I[0];K(t,{fromQueue:!0}),e(`Skipped to: ${t.title}`,"info",2e3)}else e("No more songs in queue. Please add more tracks.","info",3e3)},1500)},[e,I,K]),B=(t={})=>{const{auto:r=!1}=t;if(0===I.length)return void e(r?"Queue finished. Add more tracks to keep singing.":"Queue is empty.","info",2e3);const[n,...i]=I;K(n,{fromQueue:!0}),L(i),r||e(`Playing next: ${n.title}`,"success",2e3)};r.useEffect(()=>{T&&D()},[T,D]);const _=(e,t)=>{L(r=>{const n=r.findIndex(t=>t.id===e);if(-1===n)return r;const i="up"===t?n-1:n+1;if(i<0||i>=r.length)return r;const o=[...r],[s]=o.splice(n,1);return o.splice(i,0,s),o})},H=[{id:"youtube",label:"Open in YouTube",icon:t.jsx(a,{}),onClick:O},{id:"copy",label:"Copy Link",icon:t.jsx(l,{}),onClick:async()=>{if(T)try{await navigator.clipboard.writeText(T.watchUrl),e("Song link copied to clipboard.","success",2e3)}catch(t){e("Copy failed. Tap the YouTube button instead.","error",2800)}}},{id:"lyrics",label:"Find Lyrics",icon:t.jsx(c,{}),onClick:()=>{if(!T)return;const e=encodeURIComponent(`${T.title} lyrics`);window.open(`https://www.google.com/search?q=${e}`,"_blank","noopener,noreferrer")}},{id:"shuffle",label:"Shuffle Song",icon:t.jsx(d,{}),onClick:()=>{if(k.length<2)return void e("Need more songs to shuffle. Try another search.","info",2800);const t=k.filter(e=>e.id!==T?.id),r=t[Math.floor(Math.random()*t.length)]||k[0];E(r),L(t.filter(e=>e.id!==r.id)),e(`Random pick: ${r.title}`,"info",2400)}},{id:"lights",label:S?"Lights Off":"Lights On",icon:t.jsx(u,{}),onClick:()=>{P(e=>!e),e(S?"Stage lights dimmed.":"Stage lights on!","info",2e3)}},{id:"next",label:"Play Next in Queue",icon:t.jsx(h,{}),onClick:B},{id:"popout",label:"Pop-out Player",icon:t.jsx(p,{}),onClick:O}];return t.jsxs("div",{className:"videoke-page px-4 sm:px-8 md:px-16 pt-28 pb-24 text-white min-h-screen",children:[t.jsxs("section",{className:"videoke-hero",children:[t.jsxs("div",{className:"videoke-hero-copy",children:[t.jsx("span",{className:"videoke-badge",children:"Live Videoke Mode"}),t.jsx("h1",{children:"Mic on. Lights on. Ready, set, belt it out!"}),t.jsx("p",{children:"Type an artist, song, or pick a preset setlist. Every result is tuned for karaoke night."})]}),t.jsxs("div",{className:"videoke-search",children:[t.jsx("input",{type:"text",value:v,onChange:e=>{b(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&F(v)},placeholder:"Search for a song, artist, or genre (e.g., Morissette karaoke)"}),t.jsx("button",{type:"button",onClick:()=>{F(v)},disabled:w,children:w?"Searchingâ€¦":"Search"})]}),t.jsx("div",{className:"videoke-presets",children:f.map(e=>t.jsx("button",{type:"button",className:"videoke-preset "+(v===e.value?"active":""),onClick:()=>{return t=e.value,void F(t);var t},disabled:w,children:e.label},e.value))})]}),N&&t.jsx("p",{className:"videoke-error",children:N}),w&&t.jsxs("div",{className:"videoke-loading",children:[t.jsx("div",{className:"player-loading"}),t.jsx("p",{children:"Warming up the stageâ€¦"})]}),T&&!w&&t.jsxs("section",{className:"videoke-stage "+(S?"ambient":""),children:[t.jsxs("div",{className:"videoke-stage-frame",children:[t.jsx(y,{videoId:T.id,children:t.jsx(g,{videoId:T.id,onReady:D,onEnded:()=>{B({auto:!0})},onError:W,registerPlayer:Q},T.id)}),M&&!q&&!A&&t.jsx("div",{className:"videoke-stage-fallback",style:{backgroundColor:"rgba(0,0,0,0.8)"},children:t.jsxs("div",{className:"text-center",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸŽµ Autoplay Blocked"}),t.jsx("p",{className:"mb-4",children:"Your browser blocked autoplay. Click to start singing!"}),t.jsx("button",{type:"button",onClick:()=>{Y(!0),$(!1),D()},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold",children:"â–¶ Start Karaoke"})]})}),A&&t.jsxs("div",{className:"videoke-stage-fallback",children:[t.jsx("p",{children:A}),t.jsx("button",{type:"button",onClick:O,children:"Watch on YouTube"})]})]}),t.jsxs("div",{className:"videoke-stage-info",children:[t.jsx("span",{className:"videoke-badge",children:"Now Playing"}),t.jsx("h2",{children:T.title}),t.jsx("p",{children:T.description}),t.jsxs("div",{className:"mt-4",children:[t.jsx("button",{type:"button",onClick:()=>{Y(!0),D()},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 mr-2",children:"â–¶ Play Video"}),t.jsx("button",{type:"button",onClick:()=>{},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"ðŸ” Debug Info"})]})]}),t.jsx("div",{className:"videoke-controls",children:H.map(({id:e,label:r,icon:n,onClick:i})=>t.jsxs("button",{type:"button",onClick:i,children:[t.jsx("span",{className:"icon",children:n}),t.jsx("span",{children:r})]},e))})]}),I.length>0&&!w&&t.jsxs("section",{className:"videoke-queue",children:[t.jsxs("header",{className:"videoke-queue-header",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Up Next"}),t.jsxs("p",{children:[I.length," song",I.length>1?"s":""," lined up."]})]}),t.jsxs("div",{className:"videoke-queue-actions",children:[t.jsx("button",{type:"button",onClick:()=>B(),children:"Play next"}),t.jsx("button",{type:"button",onClick:()=>{L([]),e("Queue cleared.","info",1800)},children:"Clear queue"})]})]}),t.jsx("ol",{className:"videoke-queue-list",children:I.map((e,r)=>t.jsx("li",{children:t.jsxs("div",{className:"videoke-queue-item",children:[t.jsxs("div",{className:"videoke-queue-meta",children:[t.jsx("span",{className:"videoke-queue-index",children:r+1}),t.jsxs("div",{children:[t.jsx("h4",{title:e.title,children:e.title}),t.jsx("p",{title:e.description,children:e.description})]})]}),t.jsxs("div",{className:"videoke-queue-controls",children:[t.jsx("button",{type:"button",onClick:()=>_(e.id,"up"),"aria-label":"Move up",disabled:0===r,children:t.jsx(n,{})}),t.jsx("button",{type:"button",onClick:()=>_(e.id,"down"),"aria-label":"Move down",disabled:r===I.length-1,children:t.jsx(i,{})}),t.jsx("button",{type:"button",onClick:()=>{return t=e.id,void L(e=>e.filter(e=>e.id!==t));var t},"aria-label":"Remove from queue",children:t.jsx(o,{})}),t.jsx("button",{type:"button",onClick:()=>K(e,{fromQueue:!0}),"aria-label":"Play this song",children:t.jsx(s,{})})]})]})},e.id))})]}),!w&&!N&&0===k.length&&t.jsxs("p",{className:"videoke-empty",children:["No tracks yet for â€œ",v,"â€. Try another vibe."]}),!w&&k.length>0&&t.jsxs("section",{className:"videoke-results",children:[t.jsxs("header",{children:[t.jsx("h3",{children:"Song line-up"}),t.jsx("p",{children:"Select a track to put it on the main stage."})]}),t.jsx("div",{className:"videoke-grid",children:k.map(r=>t.jsxs("article",{className:"videoke-card "+(T?.id===r.id?"active":""),children:[t.jsx("div",{className:"videoke-card-video",children:t.jsx("iframe",{src:`https://www.youtube.com/embed/${r.id}?rel=0&modestbranding=1&autoplay=0&controls=0`,title:r.title,allowFullScreen:!1,allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",style:{pointerEvents:"none"}})}),t.jsxs("div",{className:"videoke-card-body",children:[t.jsx("h4",{title:r.title,children:r.title}),t.jsx("p",{title:r.description,children:r.description}),t.jsxs("div",{className:"videoke-card-actions",children:[t.jsx("button",{type:"button",onClick:()=>K(r),children:"Sing this"}),t.jsx("button",{type:"button",onClick:()=>{return t=r,void(I.some(e=>e.id===t.id)?e("Song already in queue.","info",2e3):(L(e=>[...e,t]),e(`Added to queue: ${t.title}`,"success",2200)));var t},disabled:I.some(e=>e.id===r.id)||T?.id===r.id,children:"Add to queue"}),t.jsx("button",{type:"button",onClick:()=>window.open(r.watchUrl,"_blank","noopener,noreferrer"),children:"Watch on YouTube"})]})]})]},r.id))})]})]})};export{b as VideokePage};
