import{r as e,j as t}from"./vendor-react-BqCNLigP.js";import{ao as s,ar as a,g as r,as as n}from"./vendor-react-ui-Bu4CYNdA.js";import{L as i}from"./index-av1fv5Wb.js";import{g as o,u as l}from"./vendor-router-C4M7CORf.js";import"./vendor-players-DUwgxdJ7.js";import"./vendor-state-9eBMMYdn.js";import"./vendor-firebase-D_MHdhg9.js";const c=["mangahere"],d={mangahere:"Mangahere"},m={mangahere:async(e,t={})=>{try{const s=new URLSearchParams({source:"mangahere",action:e,...t}).toString(),a=await fetch(`/api/manga?${s}`);if(!a.ok)throw new Error("Mangahere request failed");return await a.json()}catch(s){throw s}}},h=()=>{const{id:h,chapterId:p}=o(),x=h?decodeURIComponent(h):"",g=p?decodeURIComponent(p):"",u=l(),f=new URLSearchParams(window.location.search).get("source")||"mangahere",[b,y]=e.useState([]),[j,w]=e.useState(!0),[v,N]=e.useState(null),[k,C]=e.useState(0),[S,E]=e.useState([]),[I,R]=e.useState(-1),[T,$]=e.useState(!1),[P,U]=e.useState(!0),[L,z]=e.useState(null),[F,M]=e.useState(null),[A,B]=e.useState(f);e.useEffect(()=>{B(f)},[f]);const X=A&&A!==f?t.jsx("div",{className:"fixed inset-x-0 top-0 z-50 mt-12 flex justify-center pointer-events-none",children:t.jsxs("div",{className:"px-3 py-1 bg-amber-500/90 text-black text-xs uppercase tracking-wide rounded-full shadow-lg",children:["Resolved source: ",d[A]??A]})}):null,q=e.useCallback(async(e,t)=>{const s=[a=f,...c.filter(e=>e!==a)];var a;let r=null;for(const i of s){const s=m[i];if(!s)continue;const a=t(i);if(a)try{const t=await s(e,a);if(!t){r=new Error(`Empty response from ${i}`);continue}if(t.pages&&t.pages.length>0||t.chapters&&t.chapters.length>0)return A!==i&&B(i),{data:t,source:i};r=new Error(`No content from ${i}`)}catch(n){r=n}}throw r||new Error("No manga sources available right now")},[f,A]);e.useEffect(()=>{g&&(async()=>{try{w(!0),N(null);const{data:e}=await q("pages",()=>({chapterId:g})),t=e.pages?.map(e=>e.img)??[];if(0===t.length)throw new Error("No pages returned from any manga source");y(t)}catch(e){N("Failed to load chapter. Please try again.")}finally{w(!1)}})()},[g,f,q]),e.useEffect(()=>{x&&(async()=>{try{const{data:e}=await q("chapters",()=>({mangaId:x})),t=e.chapters||[];if(0===t.length)throw new Error("No chapter data returned");const s=t.map((e,t)=>{const s=e.chapter??t+1,a=String(null!=s?s:t+1);return{id:e.id,chapter:a,title:e.title&&e.title.trim().length>0?e.title:`Chapter ${a}`}});E(s);const a=s.findIndex(e=>e.id===g);R(a)}catch(e){}})()},[x,g,q]),e.useEffect(()=>{const e=e=>{"ArrowLeft"===e.key?G():"ArrowRight"===e.key&&H()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[k,b.length]);const W=()=>{if(!x)return"/manga";return`/manga/${encodeURIComponent(x)}?source=mangahere`},D=e=>{if(!x||!e)return"/manga";return`/manga/${encodeURIComponent(x)}/chapter/${encodeURIComponent(e)}?source=mangahere`};e.useEffect(()=>{const e=setTimeout(()=>{window.innerWidth<=768&&U(!1)},3e3);return()=>clearTimeout(e)},[k]);const G=()=>{k>0&&(C(k-1),window.scrollTo({top:0,behavior:"smooth"}))},H=()=>{if(k<b.length-1)C(k+1),window.scrollTo({top:0,behavior:"smooth"});else if(I<S.length-1){const e=S[I+1];u(D(e.id))}};if(j)return t.jsxs(t.Fragment,{children:[X,t.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:t.jsx(i,{size:"xl"})})]});if(v||0===b.length)return t.jsxs(t.Fragment,{children:[X,t.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center text-white",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xl mb-4",children:v||"No pages available"}),t.jsx("button",{onClick:()=>{u(W())},className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium",children:"Back to Manga"})]})})]});const J=S[I];return t.jsxs(t.Fragment,{children:[X,t.jsxs("div",{className:"min-h-screen bg-black text-white",children:[t.jsx("div",{className:"fixed top-0 left-0 right-0 bg-gray-900/95 backdrop-blur-sm z-50 border-b border-gray-800 transition-transform duration-300 "+(P?"translate-y-0":"-translate-y-full"),children:t.jsxs("div",{className:"container mx-auto px-2 sm:px-4 py-2 sm:py-3 flex items-center justify-between",children:[t.jsxs("button",{onClick:()=>{u(W())},className:"flex items-center gap-1 sm:gap-2 text-gray-400 hover:text-white transition-colors text-sm sm:text-base",children:[t.jsx(s,{className:"text-sm sm:text-base"}),t.jsx("span",{className:"hidden sm:inline",children:"Back"})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[t.jsxs("span",{className:"text-xs sm:text-sm text-gray-400",children:[k+1,"/",b.length]}),J&&t.jsxs("span",{className:"text-xs sm:text-sm font-medium hidden sm:inline",children:["Ch. ",J.chapter]}),t.jsxs("button",{onClick:()=>$(!T),className:"px-2 sm:px-3 py-1 sm:py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors flex items-center gap-1 sm:gap-2 text-sm",children:[t.jsx(a,{className:"text-sm"}),t.jsx("span",{className:"hidden md:inline",children:"Chapters"})]})]})]})}),T&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>$(!1),children:t.jsxs("div",{className:"fixed right-0 top-0 bottom-0 w-80 bg-gray-900 border-l border-gray-800 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"sticky top-0 bg-gray-900 border-b border-gray-800 p-4 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Chapters"}),t.jsx("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-white transition-colors",children:t.jsx(r,{})})]}),t.jsx("div",{className:"p-2",children:S.map(e=>t.jsxs("button",{onClick:()=>{u(D(e.id)),$(!1)},className:"w-full text-left p-3 rounded-lg mb-2 transition-colors "+(e.id===g?"bg-purple-600 text-white":"bg-gray-800 hover:bg-gray-700 text-gray-300"),children:[t.jsxs("div",{className:"font-semibold",children:["Chapter ",e.chapter]}),e.title&&e.title!==`Chapter ${e.chapter}`&&t.jsx("div",{className:"text-sm text-gray-400 truncate",children:e.title})]},e.id))})]})}),t.jsxs("div",{className:"pt-12 sm:pt-16",children:[t.jsx("div",{className:"flex items-center justify-center min-h-screen p-0 sm:p-4",onClick:()=>U(!P),onTouchStart:e=>{M(null),z(e.targetTouches[0].clientX)},onTouchMove:e=>{M(e.targetTouches[0].clientX)},onTouchEnd:()=>{if(!L||!F)return;const e=L-F,t=e<-50;e>50&&H(),t&&G()},children:t.jsx("img",{src:b[k],alt:`Page ${k+1}`,className:"max-w-full h-auto touch-manipulation",style:{cursor:"pointer",userSelect:"none"}})}),t.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-sm border-t border-gray-800 p-2 sm:p-4 transition-transform duration-300 "+(P?"translate-y-0":"translate-y-full"),children:[t.jsxs("div",{className:"container mx-auto flex items-center justify-between gap-2",children:[t.jsxs("button",{onClick:G,disabled:0===k,className:"px-2 sm:px-4 py-1 sm:py-2 bg-gray-800 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors flex items-center gap-1 sm:gap-2 text-sm",children:[t.jsx(s,{className:"text-sm"}),t.jsx("span",{className:"hidden sm:inline",children:"Prev"})]}),t.jsx("div",{className:"flex-1 mx-2 sm:mx-4 max-w-md",children:t.jsx("input",{type:"range",min:"0",max:b.length-1,value:k,onChange:e=>C(parseInt(e.target.value)),className:"w-full accent-purple-600"})}),t.jsxs("button",{onClick:H,className:"px-2 sm:px-4 py-1 sm:py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors flex items-center gap-1 sm:gap-2 text-sm",children:[t.jsx("span",{className:"hidden sm:inline",children:"Next"}),t.jsx(n,{className:"text-sm"})]})]}),t.jsxs("div",{className:"container mx-auto mt-2 sm:mt-3 flex items-center justify-center gap-2 sm:gap-4",children:[t.jsx("button",{onClick:()=>{if(I>0){const e=S[I-1];u(D(e.id))}},disabled:I<=0,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm bg-gray-800 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors",children:"← Prev Ch"}),t.jsx("button",{onClick:()=>{if(I<S.length-1){const e=S[I+1];u(D(e.id))}},disabled:I>=S.length-1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm bg-gray-800 hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors",children:"Next Ch →"})]})]})]})]})]})};export{h as default};
