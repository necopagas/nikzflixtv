import{r as e,j as s}from"./vendor-react-BqCNLigP.js";import{a8 as t}from"./vendor-react-ui-CyuwbvWU.js";import{g as a}from"./index-DUhc3w7m.js";import{q as r,y as i,m as n,c,b as d,v as l,d as m,w as o}from"./vendor-firebase-D_MHdhg9.js";import{u as h}from"./vendor-router-C4M7CORf.js";import"./vendor-players-DUwgxdJ7.js";import"./vendor-state-9eBMMYdn.js";const x=()=>{const{currentUser:x}=a(),{messages:p,sendMessage:u,loading:g}=(()=>{const{currentUser:s}=a(),[t,h]=e.useState([]),[x,p]=e.useState(!0);return e.useEffect(()=>{if(!s)return h([]),void p(!1);p(!0);const e=r(c(m,"chatMessages"),n("timestamp","asc"),i(100)),t=d(e,e=>{const s=e.docs.map(e=>({id:e.id,...e.data()}));h(s),p(!1)},e=>{p(!1)});return()=>t()},[s]),{messages:t,sendMessage:async e=>{if(s&&e.trim())try{await l(c(m,"chatMessages"),{text:e,uid:s.uid,displayName:s.displayName||s.email.split("@")[0],timestamp:o()})}catch(t){}},loading:x}})(),[j,v]=e.useState(""),N=e.useRef(null),f=h();e.useEffect(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[p]);return g?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx("div",{className:"player-loading"})}):x?s.jsxs("div",{className:"chat-room-container pt-28 pb-20 px-4 sm:px-8 md:px-16",children:[s.jsx("h1",{className:"text-3xl font-bold mb-8 text-center",children:"NikzFlix Public Chat"}),s.jsxs("div",{className:"chat-messages-wrapper",children:[s.jsxs("div",{className:"chat-messages",children:[0===p.length&&!g&&s.jsxs("div",{className:"text-center text-(--text-secondary) p-8",children:[s.jsx("p",{className:"text-lg",children:"Welcome to the chat!"}),s.jsx("p",{children:"Be the first to send a message."})]}),p.map(e=>{return s.jsxs("div",{className:"chat-message "+(e.uid===x.uid?"current-user":""),children:[s.jsx("div",{className:"chat-avatar",title:e.displayName||"User",children:(e.displayName||"User").charAt(0)}),s.jsxs("div",{className:"message-body",children:[s.jsxs("div",{className:"message-details",children:[s.jsx("span",{className:"message-sender",children:e.uid===x.uid?"You":e.displayName||"User"}),s.jsx("span",{className:"message-timestamp",children:(t=e.timestamp,t&&t.seconds?new Date(1e3*t.seconds).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"sending...")})]}),s.jsx("div",{className:"message-content",children:s.jsx("p",{children:e.text})})]})]},e.id);var t}),s.jsx("div",{ref:N})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),""!==j.trim()&&(u(j),v(""))},className:"chat-form",children:[s.jsx("input",{type:"text",value:j,onChange:e=>v(e.target.value),placeholder:"Type your message here...",className:"chat-input"}),s.jsx("button",{type:"submit",className:"chat-send-btn",title:"Send Message","aria-label":"Send message",children:s.jsx(t,{})})]})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen pt-20 text-center",children:[s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Chat Room Access Denied"}),s.jsx("p",{className:"text-lg text-(--text-secondary) mb-6",children:"You need to be logged in to join the conversation."}),s.jsx("button",{onClick:()=>f("/auth"),className:"px-6 py-3 bg-red-600 text-white font-bold rounded hover:bg-red-700",children:"Login"})]})};export{x as ChatRoomPage};
