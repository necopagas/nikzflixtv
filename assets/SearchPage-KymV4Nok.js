import{r as e,j as t}from"./vendor-react-BqCNLigP.js";import{A as a,f as r}from"./index-av1fv5Wb.js";import{O as s,P as l,Q as n,p as i,R as o,S as c,T as d,U as m,V as g,F as x}from"./vendor-react-ui-Bu4CYNdA.js";import{P as u,O as p}from"./ProgressiveImage-CUS--CJf.js";import{f as h}from"./vendor-router-C4M7CORf.js";import"./vendor-players-DUwgxdJ7.js";import"./vendor-state-9eBMMYdn.js";import"./vendor-firebase-D_MHdhg9.js";const y=["Action","Adventure","Animation","Comedy","Crime","Documentary","Drama","Family","Fantasy","Horror","Mystery","Romance","Sci-Fi","Thriller","War","Western"],f=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"zh",name:"Chinese"},{code:"hi",name:"Hindi"},{code:"tl",name:"Filipino"}],b=[{label:"All Ratings",min:0,max:10},{label:"9+ Excellent",min:9,max:10},{label:"7+ Good",min:7,max:10},{label:"5+ Average",min:5,max:10}],j=(new Date).getFullYear(),v=Array.from({length:50},(e,t)=>j-t),N=({onSearch:a,onFilterChange:r,placeholder:u="Search movies, anime, dramas...",showFilters:p=!0,recentSearches:h=null,popularSearches:j=[],className:N=""})=>{const[w,S]=e.useState(""),[C,_]=e.useState(!1),[k,R]=e.useState(!1),[A,F]=e.useState(!1),[B,E]=e.useState({year:"",genre:"",language:"",rating:{min:0,max:10},sortBy:"popularity"}),[T,D]=e.useState(()=>{if(h)return h;const e=localStorage.getItem("searchHistory");return e?JSON.parse(e):[]}),L=e.useRef(null),O=e.useRef(null),P=e.useRef(null),M=e.useRef(null),H=e.useCallback(e=>{if(!e.trim())return;const t=[e,...T.filter(t=>t!==e)].slice(0,10);D(t),localStorage.setItem("searchHistory",JSON.stringify(t)),a&&a(e,B),F(!1)},[T,a,B]);e.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;O.current=new e,O.current.continuous=!1,O.current.interimResults=!1,O.current.lang="en-US",O.current.onresult=e=>{const t=e.results[0][0].transcript;S(t),_(!1),H(t)},O.current.onerror=e=>{_(!1)},O.current.onend=()=>{_(!1)}}return()=>{O.current&&O.current.stop()}},[H]),e.useEffect(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&F(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.useEffect(()=>(w.length>=2&&(clearTimeout(P.current),P.current=setTimeout(()=>{H(w)},300)),()=>clearTimeout(P.current)),[w,H]),e.useEffect(()=>{r&&r(B)},[B,r]);const z=(e,t)=>{E(a=>({...a,[e]:t}))},G=e.useMemo(()=>{let e=0;return B.year&&e++,B.genre&&e++,B.language&&e++,(B.rating.min>0||B.rating.max<10)&&e++,e},[B]),I=e.useMemo(()=>{if(!w||w.length<2)return T.slice(0,5);const e=w.toLowerCase();return[...T.filter(t=>t.toLowerCase().includes(e)),...j].filter((e,t,a)=>a.indexOf(e)===t).slice(0,5)},[w,T,j]);return t.jsxs("div",{className:`relative ${N}`,ref:M,children:[t.jsxs("div",{className:"relative flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(s,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl"}),t.jsx("input",{ref:L,type:"text",value:w,onChange:e=>S(e.target.value),onFocus:()=>F(!0),onKeyDown:e=>{"Enter"===e.key&&H(w)},placeholder:u,className:"w-full pl-12 pr-32 py-4 bg-gray-800 text-white rounded-xl border-2 border-gray-700 focus:border-purple-500 focus:outline-none transition-colors"}),t.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{O.current?C?(O.current.stop(),_(!1)):(O.current.start(),_(!0)):alert("Voice search is not supported in your browser. Please use Chrome or Edge.")},className:"p-2 rounded-lg transition-all "+(C?"bg-red-500 text-white animate-pulse":"bg-gray-700 text-gray-300 hover:bg-gray-600"),title:C?"Stop listening":"Voice search",children:C?t.jsx(l,{className:"text-lg"}):t.jsx(n,{className:"text-lg"})}),w&&t.jsx("button",{onClick:()=>S(""),className:"p-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors",title:"Clear",children:t.jsx(i,{className:"text-lg"})})]})]}),p&&t.jsxs("button",{onClick:()=>R(!k),className:"relative px-6 py-4 rounded-xl font-medium transition-all "+(k?"bg-purple-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700 border-2 border-gray-700"),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{className:"text-xl"}),t.jsx("span",{className:"hidden sm:inline",children:"Filters"})]}),G>0&&t.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center",children:G})]})]}),A&&(I.length>0||T.length>0)&&t.jsxs("div",{className:"absolute top-full mt-2 left-0 right-0 bg-gray-800 rounded-xl shadow-2xl border border-gray-700 z-50 max-h-96 overflow-y-auto",children:[T.length>0&&t.jsxs("div",{className:"p-4 border-b border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-400 flex items-center gap-2",children:[t.jsx(c,{})," Recent Searches"]}),t.jsx("button",{onClick:()=>{D([]),localStorage.removeItem("searchHistory")},className:"text-xs text-red-400 hover:text-red-300",children:"Clear All"})]}),t.jsx("div",{className:"space-y-1",children:I.map((e,a)=>t.jsxs("button",{onClick:()=>{S(e),H(e)},className:"w-full text-left px-3 py-2 text-white hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-3",children:[t.jsx(s,{className:"text-gray-400"}),t.jsx("span",{children:e})]},a))})]}),j.length>0&&t.jsxs("div",{className:"p-4",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-400 mb-3 flex items-center gap-2",children:[t.jsx(d,{})," Popular Searches"]}),t.jsx("div",{className:"space-y-1",children:j.slice(0,5).map((e,a)=>t.jsxs("button",{onClick:()=>{S(e),H(e)},className:"w-full text-left px-3 py-2 text-white hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-3",children:[t.jsx(d,{className:"text-purple-400"}),t.jsx("span",{children:e})]},a))})]})]}),k&&t.jsxs("div",{className:"absolute top-full mt-2 right-0 bg-gray-800 rounded-xl shadow-2xl border border-gray-700 z-50 w-full md:w-96 p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-bold text-white",children:"Advanced Filters"}),t.jsx("button",{onClick:()=>{E({year:"",genre:"",language:"",rating:{min:0,max:10},sortBy:"popularity"})},className:"text-sm text-purple-400 hover:text-purple-300",children:"Clear All"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[t.jsx(m,{})," Release Year"]}),t.jsxs("select",{value:B.year,onChange:e=>z("year",e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"All Years"}),v.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[t.jsx(g,{})," Genre"]}),t.jsxs("select",{value:B.genre,onChange:e=>z("genre",e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"All Genres"}),y.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Language"}),t.jsxs("select",{value:B.language,onChange:e=>z("language",e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"All Languages"}),f.map(e=>t.jsx("option",{value:e.code,children:e.name},e.code))]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-medium text-gray-400 mb-2 flex items-center gap-2",children:[t.jsx(x,{})," Minimum Rating"]}),t.jsx("div",{className:"space-y-2",children:b.map((e,a)=>t.jsx("button",{onClick:()=>z("rating",{min:e.min,max:e.max}),className:"w-full px-4 py-2 rounded-lg text-left transition-colors "+(B.rating.min===e.min&&B.rating.max===e.max?"bg-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:e.label},a))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Sort By"}),t.jsxs("select",{value:B.sortBy,onChange:e=>z("sortBy",e.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none",children:[t.jsx("option",{value:"popularity",children:"Popularity"}),t.jsx("option",{value:"rating",children:"Rating"}),t.jsx("option",{value:"release_date",children:"Release Date"}),t.jsx("option",{value:"title",children:"Title (A-Z)"})]})]})]}),C&&t.jsxs("div",{className:"absolute top-full mt-2 left-0 right-0 bg-red-500 text-white px-6 py-4 rounded-xl shadow-2xl z-50 flex items-center gap-4",children:[t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1 h-8 bg-white rounded-full animate-pulse"}),t.jsx("div",{className:"w-1 h-8 bg-white rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-1 h-8 bg-white rounded-full animate-pulse delay-150"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold",children:"Listening..."}),t.jsx("p",{className:"text-sm opacity-90",children:"Speak now"})]})]})]})},w=({onOpenModal:s,isWatched:l})=>{const[n,i]=h(),o=n.get("q")||"",[c,d]=e.useState([]),[m,g]=e.useState(!1),[x,y]=e.useState({year:"",genre:"",language:"",rating:{min:0,max:10},sortBy:"popularity"});e.useEffect(()=>{o?f(o,x):d([])},[o,x]);const f=async(e,t)=>{if(e){g(!0);try{let s=a.search(e);const l=new URLSearchParams;t.year&&l.append("year",t.year),t.genre&&l.append("with_genres",t.genre),t.language&&l.append("language",t.language),t.rating.min>0&&l.append("vote_average.gte",t.rating.min),t.rating.max<10&&l.append("vote_average.lte",t.rating.max);const n=l.toString();n&&(s+=(s.includes("?")?"&":"?")+n);let i=((await r(s)).results||[]).filter(e=>"movie"===e.media_type||"tv"===e.media_type).map(e=>({id:e.id,title:e.title||e.name,name:e.name||e.title,poster_path:e.poster_path,backdrop_path:e.backdrop_path,vote_average:e.vote_average,media_type:e.media_type,genre_ids:e.genre_ids||[],release_date:e.release_date||e.first_air_date})).filter(e=>e.poster_path);"rating"===t.sortBy?i.sort((e,t)=>(t.vote_average||0)-(e.vote_average||0)):"release_date"===t.sortBy?i.sort((e,t)=>new Date(t.release_date||0)-new Date(e.release_date||0)):"title"===t.sortBy&&i.sort((e,t)=>(e.title||"").localeCompare(t.title||"")),d(i)}catch(s){d([])}finally{g(!1)}}};return t.jsxs("div",{className:"px-4 sm:px-8 md:px-16 pt-28 pb-20",children:[t.jsx("div",{className:"mb-12",children:t.jsx(N,{onSearch:(e,t)=>{i({q:e}),f(e,t||x)},onFilterChange:e=>{y(e),o&&f(o,e)},placeholder:"Search movies, anime, dramas, and more...",showFilters:!0,popularSearches:["Avengers","Naruto","One Piece","Spider-Man","Demon Slayer","The Batman","Stranger Things","Breaking Bad"]})}),o&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h2",{className:"text-3xl font-bold mb-2",children:['Search Results for "',o,'"']}),t.jsx("p",{className:"text-gray-400",children:m?"Searching...":`${c.length} results found`})]}),m?t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:t.jsx(u,{count:12})}):c.length>0?t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:c.map(e=>t.jsx(p,{item:e,onClick:s,isWatched:e=>l(e),showTitle:!0},e.id))}):o?t.jsxs("div",{className:"text-center py-20",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”"}),t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"No results found"}),t.jsx("p",{className:"text-gray-400 mb-6",children:"Try adjusting your search or filters"}),t.jsx("button",{onClick:()=>{i({}),y({year:"",genre:"",language:"",rating:{min:0,max:10},sortBy:"popularity"})},className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-colors",children:"Clear Search"})]}):t.jsxs("div",{className:"text-center py-20",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¬"}),t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Start searching"}),t.jsx("p",{className:"text-gray-400",children:"Enter a query above to find movies, anime, and dramas"})]})]})};export{w as SearchPage};
